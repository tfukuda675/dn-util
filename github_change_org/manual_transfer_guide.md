# 手動リポジトリ転送ガイド

GitHubのリポジトリ転送は、重要な設定やデータが関わるため、**手動実施を強く推奨**します。

## 手動転送が推奨される理由

### 1. 確実性と安全性
- 各リポジトリの状況を個別に確認できる
- 転送前後の設定を詳細にチェックできる
- 問題が発生した場合に即座に対応できる

### 2. 設定の継承確認
- ブランチ保護ルール
- Webhooks
- Secrets
- Deploy keys
- Collaborator権限

### 3. 依存関係の管理
- 外部サービスとの連携
- CI/CDパイプライン
- Issue/PRの参照関係

## 手動転送の手順

### 事前準備（必須）

1. **リポジトリ一覧の作成**
   ```bash
   # スクリプトでリポジトリ一覧を取得
   python github_org_transfer.py list-repos --org source-org > repos_list.txt
   ```

2. **バックアップの作成**
   - 重要なリポジトリのローカルクローン
   - 設定情報のエクスポート
   - Issue/PRのデータ保存

3. **転送先organizationの準備**
   - 必要な権限の確認
   - チーム設定の準備
   - 同名リポジトリの確認

### 転送手順（リポジトリごと）

#### 1. 転送前チェック
- [ ] 管理者権限があることを確認
- [ ] フォークでないことを確認
- [ ] 転送先に同名リポジトリが存在しないことを確認
- [ ] アクティブなPR/Issueがないか確認

#### 2. 転送実行
1. GitHubのリポジトリページにアクセス
2. **Settings** → **General** に移動
3. 最下部の **Danger Zone** を確認
4. **Transfer** ボタンをクリック
5. 転送先organization名を入力
6. リポジトリ名を再入力して確認
7. **I understand, transfer this repository** をクリック

#### 3. 転送後確認
- [ ] 転送先でリポジトリが正常に表示される
- [ ] ブランチ保護ルールの再設定
- [ ] Webhookの再設定
- [ ] Secretsの再設定
- [ ] Collaboratorの確認と調整
- [ ] CI/CDパイプラインの動作確認

#### 4. 外部連携の更新
- [ ] 外部サービスのWebhook URL更新
- [ ] ドキュメント内のリンク更新
- [ ] ローカル開発環境のremote URL更新
   ```bash
   git remote set-url origin https://github.com/new-org/repo-name.git
   ```

### 転送優先順位

#### 高優先度（最初に転送）
- ライブラリ・フレームワーク
- 依存関係が少ないリポジトリ
- アーカイブ済みリポジトリ

#### 中優先度
- アプリケーションリポジトリ
- ドキュメントリポジトリ

#### 低優先度（最後に転送）
- メインアプリケーション
- 多くの外部連携があるリポジトリ
- 本番環境で稼働中のリポジトリ

## 緊急時の対応

### 転送失敗時
1. エラーメッセージを記録
2. 原因の特定（権限、同名リポジトリ、フォークなど）
3. 必要に応じて転送をキャンセル
4. 問題解決後に再試行

### データ損失が疑われる場合
1. バックアップからの復旧を準備
2. GitHub Supportに連絡
3. 関係者への緊急連絡

## チェックリスト（転送完了後）

### 技術的確認
- [ ] 全リポジトリが転送先で正常に動作
- [ ] CI/CDパイプラインが正常に実行
- [ ] 外部サービスとの連携が正常
- [ ] ローカル開発環境の更新完了

### 管理的確認
- [ ] チームメンバーの権限確認
- [ ] ドキュメントの更新完了
- [ ] 外部パートナーへの通知完了
- [ ] 旧organizationの清理完了

## よくある問題と解決策

### 権限不足エラー
- **原因**: 管理者権限がない
- **解決**: リポジトリオーナーに権限付与を依頼

### 同名リポジトリエラー
- **原因**: 転送先に同名のリポジトリが存在
- **解決**: 転送先のリポジトリ名変更または削除

### フォーク転送エラー
- **原因**: フォークされたリポジトリは転送不可
- **解決**: 必要に応じて新規リポジトリとして作成

### Personal Access Token期限切れ
- **原因**: APIアクセストークンの有効期限切れ
- **解決**: 新しいトークンを生成し、必要な権限を設定

## 推奨される転送スケジュール

### 大規模組織（50+リポジトリ）
- **期間**: 2-4週間
- **ペース**: 5-10リポジトリ/日
- **タイミング**: 営業時間外

### 中規模組織（10-50リポジトリ）
- **期間**: 1-2週間  
- **ペース**: 3-5リポジトリ/日
- **タイミング**: 開発の負荷が低い時期

### 小規模組織（<10リポジトリ）
- **期間**: 2-3日
- **ペース**: 全て手動で慎重に実行
- **タイミング**: メンテナンス時間帯

手動転送は時間がかかりますが、重要なデータとサービスの継続性を確保する最も確実な方法です。